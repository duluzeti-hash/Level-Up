<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Monitoramento do Jogo INDO</title>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet" />

<style>
    /* --- INÍCIO DOS ESTILOS CORRIGIDOS --- */

    /* Estilos do Jogo Principal (Caminhão e Caixa Escura) */
    body {
        font-family: Arial, sans-serif;
        background: url('/imagens/fundo-caminhao.jpg') no-repeat center center fixed;
        background-size: cover;
        color: #fff; /* Texto branco */
        min-height: 100vh;
        padding: 20px;
        font-size: 1.1rem;
    }

    /* O container principal (caixa escura) */
    #container {
        background: rgba(0, 0, 0, 0.65); /* Caixa escura */
        padding: 30px;
        border-radius: 12px;
        max-width: 900px;
        margin: 0 auto;
        box-shadow: 0 0 15px #000;
        
        /* Layout flexível para os boxes */
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }

    /* As caixas de informação (agora escuras) */
    .box {
        background: rgba(0, 0, 0, 0.3); /* Fundo escuro para os boxes */
        padding: 15px;
        border-radius: 8px;
        flex: 1;
        min-width: 280px;
        border: 1px solid rgba(255, 165, 0, 0.5); /* Borda laranja */
    }
    
    /* Título Principal (Monitoramento...) */
    h1 { 
        color: #ffa500; /* Laranja do logo */
        text-align: center; 
        text-shadow: 1px 1px 4px #000;
        font-family: 'Lobster', cursive; /* Fonte do logo */
        font-size: 3.5rem; /* Tamanho do logo */
        margin-bottom: 20px;
    }
    
    /* Títulos dos boxes (Status do Jogo, Rodada...) */
    h2 { 
        margin-top: 10px; 
        border-bottom: 2px solid #ffa500; /* Laranja */
        padding-bottom: 5px; 
        color: #ffffb3; /* Amarelo claro do subtítulo */
        text-shadow: 1px 1px 2px #000;
    }

    ul { list-style: none; padding-left: 0; }
    
    /* Itens das listas (jogadores, dicas, etc.) */
    li { 
        background: rgba(0, 0, 0, 0.5); /* Fundo escuro para itens da lista */
        margin: 5px 0; 
        padding: 8px 15px; 
        border-radius: 5px; 
        border: 1px solid rgba(255, 165, 0, 0.3);
    }

    /* Estilos específicos do Monitor */
    #status-jogo { font-size: 1.2em; font-weight: bold; color: #95ff00; } /* Verde-limão */
    #cronometro { font-size: 1.5em; font-weight: bold; color: #d9534f; }
    
    #lista-log {
        max-height: 200px;
        overflow-y: auto;
        font-size: 0.9em;
        color: #ddd;
    }
    #lista-log li { 
        background: rgba(0, 0, 0, 0.2);
        padding: 5px; 
        color: #ddd;
        border: none;
        font-size: 0.95em;
    }
    /* --- FIM DOS ESTILOS CORRIGIDOS --- */


    /* --- ESTILOS DO RESUMO DA RODADA (MONITOR) --- */

    /* O overlay de fundo (tela cheia) */
    #monitor-resumo-overlay {
        position: fixed; /* Fica por cima de tudo */
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9); /* Fundo bem escuro */
        z-index: 1000;
        
        /* Começa escondido */
        display: none; 
        
        /* Centraliza o conteúdo */
        align-items: center;
        justify-content: center;
        padding: 20px;
    }

    /* O container das duas colunas */
    #resumo-container {
        display: flex;
        gap: 20px;
        width: 100%;
        max-width: 1200px; /* Limita a largura */
    }

    /* Estilo de cada coluna (Gabarito e Placar) */
    .resumo-coluna {
        flex: 1; /* Faz as colunas terem 50% de largura */
        background: rgba(0, 0, 0, 0.5); /* Fundo (como os .box) */
        padding: 20px;
        border-radius: 8px;
        border: 1px solid rgba(255, 165, 0, 0.5); /* Borda laranja */
        
        /* Controle de altura caso a lista seja longa */
        max-height: 80vh; 
        overflow-y: auto;
    }

    /* O ESTILO CIANO "ILUMINADO" QUE VOCÊ PEDIU */
    .titulo-ciano {
        font-family: Arial, sans-serif; /* Fonte limpa para o título */
        font-size: 1.8rem;
        color: #00FFFF; /* Ciano puro */
        
        /* Efeito "iluminado" (glow) */
        text-shadow: 0 0 4px #00FFFF, 
                     0 0 8px #00FFFF, 
                     0 0 12px rgba(0, 255, 255, 0.7);
                     
        margin-bottom: 15px;
        border-bottom: 2px solid #00FFFF; /* Linha ciano */
        padding-bottom: 5px;
    }

    /* Estilo das listas (similar ao que já existe) */
    .resumo-coluna ul {
        list-style: none;
        padding: 0;
    }

    .resumo-coluna li {
        background: rgba(0, 0, 0, 0.5); 
        margin: 8px 0; 
        padding: 10px 15px; 
        border-radius: 5px; 
        border: 1px solid rgba(255, 165, 0, 0.3);
        font-size: 1.1rem;
        color: #fff; /* Texto branco normal para o placar */
    }

    /* Destaque especial para o gabarito */
    #resumo-lista-gabarito li {
        color: #00FFFF; /* Texto ciano */
        font-weight: bold;
    }
</style>
</head>
<body>

  <h1>Monitoramento em Tempo Real - Jogo INDO</h1>

    <div id="container">

    <div class="box" id="status-geral">
        <h2>Status do Jogo</h2>
        <p><strong id="status-jogo">Aguardando início...</strong></p>
    </div>

    <div class="box" id="rodada-atual">
      <h2>Rodada Atual</h2>
      <p><strong>Número:</strong> <span id="numero-rodada">0</span></p>
      <p><strong>Tema:</strong> <span id="tema-rodada">Aguardando...</span></p>
      <p><strong>Jogador da Vez:</strong> <span id="jogador-da-vez">Ninguém</span></p>
      <p><strong>Tempo Restante:</strong> <span id="cronometro">--:--</span></p>
    </div>

    <div class="box" id="pontuacao">
      <h2>Pontuação</h2>
      <ul id="placar">
          </ul>
    </div>

    <div class="box" id="status-jogadores">
      <h2>Jogadores Conectados</h2>
      <ul id="lista-jogadores">
          </ul>
    </div>

    <div class="box" id="dicas">
      <h2>Dicas da Rodada</h2>
      <ul id="lista-dicas">
          </ul>
    </div>

    <div class="box" id="log-eventos">
      <h2>Log de Eventos</h2>
      <ul id="lista-log">
          </ul>
    </div>
  </div>

  <script>
    // Conecta ao servidor (mesmo endereço do jogo)
    const socket = io();

    // Seletores (buscando uma vez para melhor performance)
    const elListaJogadores = document.getElementById("lista-jogadores");
    const elNumeroRodada = document.getElementById("numero-rodada");
    const elTemaRodada = document.getElementById("tema-rodada");
    const elPlacar = document.getElementById("placar");
    const elListaDicas = document.getElementById("lista-dicas");
    
    // Novos seletores
    const elStatusJogo = document.getElementById("status-jogo");
    const elJogadorDaVez = document.getElementById("jogador-da-vez");
    const elCronometro = document.getElementById("cronometro");
    const elListaLog = document.getElementById("lista-log");

    // **** NOSSOS NOVOS SELETORES (DO RESUMO) ****
    const elResumoOverlay = document.getElementById("monitor-resumo-overlay");
    const elResumoGabarito = document.getElementById("resumo-lista-gabarito");
    const elResumoPlacar = document.getElementById("resumo-lista-placar");

    // --- Listeners do Socket ---

    // CORREÇÃO 1: (j.nome -> j.name)
    socket.on("atualiza-jogadores", (jogadores) => {
      elListaJogadores.innerHTML = "";
      jogadores.forEach(j => {
        const li = document.createElement("li");
        // Ex: "Duzão (Equipe 1) - Conectado"
        li.textContent = `${j.name} (Equipe ${j.equipe}) ${j.conectado ? "- Conectado" : "- Offline"}`;
        elListaJogadores.appendChild(li);
      });
    }); // <-- Correção de sintaxe (fechamento)

    socket.on("atualiza-rodada", (rodada) => {
      elNumeroRodada.textContent = rodada.numero;
      elTemaRodada.textContent = rodada.tema;
      // Limpa as dicas da rodada anterior
      elListaDicas.innerHTML = ""; 

      // **** NOSSA MUDANÇA (Esconder o resumo) ****
      if (elResumoOverlay) { 
          elResumoOverlay.style.display = "none";
      }
    }); // <-- Correção de sintaxe (fechamento)

    // CORREÇÃO 2: (for...in -> forEach)
    socket.on("atualiza-pontuacao", (pontos) => {
      elPlacar.innerHTML = "";
      // O servidor envia um array de objetos, ex: [{equipe: 'Gege', pontos: 10}]
      pontos.forEach(p => {
        const li = document.createElement("li");
        li.textContent = `${p.equipe}: ${p.pontos} pts`;
        elPlacar.appendChild(li);
      });
    });

    // Modificado para 'nova-dica' para adicionar uma por vez
    socket.on("nova-dica", (dica) => {
      const li = document.createElement("li");
      li.textContent = `${dica.jogador}: ${dica.texto}`;
      // Adiciona a dica no topo da lista
      elListaDicas.prepend(li);
    });

    // --- Novos Listeners Essenciais ---

    socket.on("atualiza-status-jogo", (statusTexto) => {
        elStatusJogo.textContent = statusTexto;
    });

    socket.on("atualiza-cronometro", (tempo) => {
        elCronometro.textContent = tempo;
    });

    socket.on("atualiza-jogador-da-vez", (jogadorNome) => {
        elJogadorDaVez.textContent = jogadorNome;
    });

    socket.on("log-evento", (mensagem) => {
        const li = document.createElement("li");
        li.textContent = `[${new Date().toLocaleTimeString()}]: ${mensagem}`;
        // Adiciona no topo e rola para o início
        elListaLog.prepend(li); 
    });

    // **** NOSSO NOVO LISTENER (Mostrar e preencher o resumo) ****
    socket.on("exibir-resumo-rodada", (dados) => {
        // dados = { gabarito: [...], placar: [...] }

        // 1. Preencher Gabarito
        elResumoGabarito.innerHTML = "";
        dados.gabarito.forEach(item => {
            const li = document.createElement("li");
            // Esperando dados como: { numero: 48, texto: 'Utilizar água...' }
            if (item.numero && item.texto) {
                 li.textContent = `(${item.numero}) ${item.texto}`;
            } else {
                 li.textContent = item; // Fallback para string simples
            }
            elResumoGabarito.appendChild(li);
        });

        // 2. Preencher Placar
        elResumoPlacar.innerHTML = "";
        dados.placar.forEach(p => {
            const li = document.createElement("li");
            // Esperando dados como: { texto: 'Du — +30 (na rodada)' }
            if (p.texto) {
                li.textContent = p.texto;
            } else {
                // Fallback para o formato antigo (se p.texto não vier)
                li.textContent = `${p.equipe}: ${p.pontos} pts`;
            }
            elResumoPlacar.appendChild(li);
        });
        
        // 3. Exibir o Overlay (IMPORTANTE: usar 'flex')
        elResumoOverlay.style.display = "flex"; 
    });

  </script>

  <div id="monitor-resumo-overlay">
    <div id="resumo-container">
        
        <div class="resumo-coluna">
            <h2 class="titulo-ciano">Gabarito da Rodada</h2>
            <ul id="resumo-lista-gabarito">
                </ul>
        </div>
        
        <div class="resumo-coluna">
            <h2 class="titulo-ciano">Placar (ranking atual)</h2>
            <ul id="resumo-lista-placar">
                </ul>
        </div>

    </div>
</div>

</body>
</html>


